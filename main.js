(()=>{"use strict";function e(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.hasRemoveButton,o=r.hasLike,c=r.onLikeClick,i=r.onRemoveClick,a=r.onImageClick,u=e.querySelector(".card").cloneNode(!0),l=u.querySelector(".card__delete-button"),s=u.querySelector(".card__like-button"),d=u.querySelector(".card__image"),p=t.link,f=t.name,m=t.likes;return u.querySelector(".card__image").src=p,u.querySelector(".card__image").alt=f,u.querySelector(".card__title").textContent=f,s.textContent=m.length,o&&s.classList.add("card__like-button_is-active"),n||l.remove(),n&&l&&i&&l.addEventListener("click",(function(e){return i(e,{cardElement:u,data:t})})),s&&c&&s.addEventListener("click",(function(e){return c(e,{cardElement:u,data:t})})),d&&a&&d.addEventListener("click",(function(e){return a(e,{cardElement:u,data:t})})),u}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var n={config:{}},o=(document.querySelector(".popup__form"),function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage||""):t.setCustomValidity(""),t.validity.valid?function(e,t){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.config.inputErrorClass),r.classList.remove(n.config.errorClass),r.textContent=""}(e,t):function(e,t,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.config.inputErrorClass),o.classList.add(n.config.errorClass),o.textContent=r}(e,t,t.validationMessage)}),c=function(e){var t=Boolean(e.querySelector(".".concat(n.config.inputErrorClass)));e.querySelector(n.config.submitButtonSelector).disabled=t};function i(e){e.target===e.currentTarget&&l(e.currentTarget)}function a(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&l(t)}}function u(e){var t=e.querySelector(".popup__form");!function(e){Array.from(e.querySelectorAll(".".concat(n.config.errorClass))).forEach((function(e){e.textContent="",e.classList.remove(n.config.errorClass)})),Array.from(e.querySelectorAll(".".concat(n.config.inputErrorClass))).forEach((function(e){e.classList.remove(n.config.inputErrorClass)}))}(t),c(t),e.classList.add("popup_is-opened"),e.addEventListener("click",i),document.addEventListener("keydown",a)}function l(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",i),document.removeEventListener("keydown",a)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var d={url:"https://mesto.nomoreparties.co/v1/wff-cohort-9",headers:{authorization:"068bc2e7-aab7-4445-854c-1c5632721607","Content-Type":"application/json"}},p=function(e){return e.ok?e.json():Promise.reject(e.status)},f=function(e){console.error("Ошибка:",e)},m=document.querySelector("#card-template").content,y=document.querySelector(".places__list"),_=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_edit"),h=document.querySelector(".profile__add-button"),b=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),g=document.querySelectorAll(".popup__close");v.classList.add("popup_is-animated"),S.classList.add("popup_is-animated"),b.classList.add("popup_is-animated"),_.addEventListener("click",(function(){q.value=k.textContent,L.value=C.textContent,u(v)})),h.addEventListener("click",(function(){O.reset(),u(b)})),g.forEach((function(e){var t=e.closest(".popup");t&&e.addEventListener("click",(function(){l(t)}))}));var E=document.querySelector('.popup__form[name="edit-profile"]'),k=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),q=document.querySelector(".popup__input_type_name"),L=document.querySelector(".popup__input_type_description");E.addEventListener("submit",(function(e){var t,r;e.preventDefault(),k.textContent=q.value,C.textContent=L.value,(t=q.value,r=L.value,fetch("".concat(d.url,"/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:t,about:r})}).then(p).catch(f)).then((function(e){q.value=e.name,L.value=e.about,l(v)}))}));var O=document.querySelector('.popup__form[name="new-place"]'),j=document.querySelector(".popup__input_type_card-name"),w=document.querySelector(".popup__input_type_url"),A=function(e,t){var r;(r=t.data._id,fetch("".concat(d.url,"/cards/").concat(r),{method:"DELETE",headers:d.headers}).then(p).catch(f)).then((function(){!function(e,t){t.cardElement.remove()}(0,t)}))},P=function(e,t){var r,n=t.cardElement,o=t.data,c=n.querySelector(".card__like-button");c.classList.contains("card__like-button_is-active")?(r=o._id,fetch("".concat(d.url,"/cards/likes/").concat(r),{method:"DELETE",headers:d.headers}).then(p).catch(f)).then((function(e){c.textContent=e.likes.length,c.classList.toggle("card__like-button_is-active")})):function(e){return fetch("".concat(d.url,"/cards/likes/").concat(e),{method:"PUT",headers:d.headers}).then(p).catch(f)}(o._id).then((function(e){c.textContent=e.likes.length,c.classList.toggle("card__like-button_is-active")}))};O.addEventListener("submit",(function(t){var r,n;t.preventDefault(),(r=j.value,n=w.value,fetch("".concat(d.url,"/cards"),{method:"POST",headers:d.headers,body:JSON.stringify({name:r,link:n})}).then(p).catch(f)).then((function(t){var r=e(m,t,{onLikeClick:P,onRemoveClick:A,onImageClick:D,hasRemoveButton:!0});y.prepend(r),O.reset(),l(b)}))}));var x=document.querySelector(".popup__image"),T=document.querySelector(".popup__caption");function D(e){x.src=e.target.src,x.alt=e.target.alt,T.textContent=e.target.alt,u(S)}document.addEventListener("DOMContentLoaded",(function(){var i;i={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},n.config=function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(Object(o),!0).forEach((function(r){var n,c,i,a;n=e,c=r,i=o[r],a=function(e,r){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(c),(c="symbol"==t(a)?a:String(a))in n?Object.defineProperty(n,c,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[c]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},i),Array.from(document.querySelectorAll(n.config.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(n.config.inputSelector));e.querySelector(n.config.submitButtonSelector),c(e),t.forEach((function(t){t.addEventListener("input",(function(){o(e,t),c(e)}))}))}(e)})),Promise.all([fetch("".concat(d.url,"/users/me"),{method:"GET",headers:d.headers}).then(p).catch(f),fetch("".concat(d.url,"/cards"),{method:"GET",headers:d.headers}).then(p).catch(f)]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c,i,a=[],u=!0,l=!1;try{if(c=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=c.call(r)).done)&&(a.push(n.value),a.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return a}}(t,r)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return{profileInfo:n[0],cardsInfo:n[1]}})).then((function(t){var r=t.profileInfo,n=t.cardsInfo;k.textContent=r.name,C.textContent=r.about,n.forEach((function(t){var n=e(m,t,{onLikeClick:P,onRemoveClick:A,onImageClick:D,hasRemoveButton:r._id===t.owner._id,hasLike:t.likes.some((function(e){return e._id===r._id}))});y.append(n)}))}))}))})();